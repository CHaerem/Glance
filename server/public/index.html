<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Glance</title>
    <!-- Preload critical resources -->
    <link rel="preload" href="/css/styles.css" as="style">
    <link rel="preload" href="/js/main.js" as="script">
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com">
    <!-- Styles -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>GLANCE</h1>
        </div>

        <!-- Current Display (LCP element - prioritize loading) -->
        <div class="current-status">
            <div id="currentImagePreview">
                <img id="currentImageThumb" src="" alt="Current display" fetchpriority="high" decoding="async">
                <div id="currentImagePrompt"></div>
            </div>
        </div>

        <!-- Mode Toggle -->
        <div class="mode-toggle">
            <button class="mode-link" id="createLink">create</button>
            <span style="color: #e5e5e5;">|</span>
            <button class="mode-link" id="exploreLink">explore</button>
            <span style="color: #e5e5e5;">|</span>
            <button class="mode-link" id="myCollectionLink">collection</button>
        </div>

        <!-- Create Mode (default) -->
        <div class="main-input" id="createMode">
            <!-- Generate Section -->
            <div class="input-area">
                <textarea
                    class="main-textarea"
                    id="promptInput"
                    placeholder="Describe the image you want to see..."></textarea>
                <div class="input-actions">
                    <button class="btn btn-primary" id="generateBtn">Generate</button>
                    <button class="btn btn-secondary" id="luckyBtn">Feeling Lucky</button>
                </div>
            </div>

            <!-- Separator -->
            <div style="text-align: center; margin: 40px 0 30px; color: #ccc; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1px;">
                or
            </div>

            <!-- Upload Section -->
            <div class="input-area" id="dropZone" style="cursor: pointer;">
                <div style="padding: 40px 20px; text-align: center;">
                    <div style="color: #999; font-size: 0.9rem; margin-bottom: 8px;">Upload an image</div>
                    <div style="color: #ccc; font-size: 0.75rem;">Click or drag image here</div>
                </div>
            </div>
        </div>

        <!-- Explore Mode -->
        <div class="browse-section" id="exploreMode">
            <!-- Search Input -->
            <div class="explore-search-container">
                <input
                    type="text"
                    class="explore-search-input"
                    id="searchInput"
                    placeholder="explore art...">
                <button class="explore-random-btn" id="randomArtBtn" title="Random artwork">üé≤</button>
            </div>

            <!-- Quick Suggestions (right after search) -->
            <div class="quick-suggestions" id="quickSuggestions">
                <span class="suggestions-label">or try:</span>
                <span class="suggestion-chip" data-query="impressionists">impressionists</span>
                <span class="suggestion-chip" data-query="portraits">portraits</span>
                <span class="suggestion-chip" data-query="landscapes">landscapes</span>
                <span class="suggestion-chip" data-query="abstract">abstract</span>
                <span class="suggestion-chip" data-query="dutch masters">dutch masters</span>
                <span class="suggestion-chip" data-query="japanese art">japanese</span>
            </div>

            <!-- Guide Response (shows after AI responds) -->
            <div class="guide-response" id="guideResponse" style="display: none;">
                <!-- Shows guide responses briefly -->
            </div>

            <!-- Featured Movement Section -->
            <div class="explore-section" id="featuredSection" style="display: none;">
                <div class="featured-card" id="featuredCard">
                    <div class="featured-header">
                        <span class="featured-label">featured movement</span>
                        <span class="featured-period" id="featuredPeriod"></span>
                    </div>
                    <h3 class="featured-title" id="featuredTitle"></h3>
                    <p class="featured-description" id="featuredDescription"></p>
                    <div class="featured-artworks" id="featuredArtworks">
                        <!-- 4 preview thumbnails -->
                    </div>
                    <button class="featured-explore-btn" id="exploreFeaturedBtn">explore movement ‚Üí</button>
                </div>
            </div>

            <!-- Mood Suggestion -->
            <div class="explore-section" id="moodSection" style="display: none;">
                <div class="mood-card" id="moodCard">
                    <span class="mood-label" id="moodLabel">morning calm</span>
                    <span class="mood-description" id="moodDescription">Peaceful scenes to start your day</span>
                    <button class="mood-btn" id="moodBtn">show me ‚Üí</button>
                </div>
            </div>

            <!-- Browse by Movement -->
            <div class="explore-section" id="movementsSection" style="display: none;">
                <div class="section-header">
                    <span class="section-title">browse by movement</span>
                </div>
                <div class="movements-scroll-container">
                    <div class="movements-scroll" id="movementsScroll">
                        <!-- Populated dynamically with movement cards -->
                    </div>
                </div>
            </div>

            <!-- Playlists Section -->
            <div class="explore-section" id="playlistsSection">
                <div class="section-header">
                    <span class="section-title">playlists</span>
                    <button class="section-link" id="seeAllPlaylists">see all</button>
                </div>
                <div class="playlist-scroll-container">
                    <div class="playlist-scroll" id="playlistScroll">
                        <!-- Populated dynamically with playlist cards -->
                    </div>
                </div>
            </div>

            <!-- Today's Gallery Section -->
            <div class="explore-section" id="todaysGallerySection">
                <div class="section-header">
                    <span class="section-title">today's gallery</span>
                    <span class="section-actions">
                        <button class="section-link" id="playGallery">‚ñ∂ play</button>
                        <button class="section-link" id="refreshGallery">refresh ‚Üª</button>
                    </span>
                </div>
                <div class="todays-gallery-grid" id="todaysGallery">
                    <!-- Populated dynamically with 8 famous artworks -->
                </div>
            </div>

            <!-- Search Results (hidden by default, shown when searching) -->
            <div class="search-results-section" id="searchResultsSection" style="display: none;">
                <div class="section-header search-header">
                    <button class="back-button" id="clearSearch">‚Üê back</button>
                    <span class="section-title" id="searchResultsTitle">results</span>
                </div>

                <!-- Refinement chips (shown after search) -->
                <div class="refinement-chips" id="refinementChips" style="display: none;">
                    <!-- Populated dynamically based on search results -->
                </div>

                <!-- Art Cards Grid -->
                <div class="art-cards" id="artCards">
                    <!-- Populated dynamically with physical cards -->
                </div>

                <!-- Show more button -->
                <div class="show-more" id="browseShowMore" style="display: none;">
                    <button class="show-more-btn" id="showMoreBrowseBtn">show more</button>
                </div>
            </div>

            <!-- Playlist View (hidden by default, shown when viewing a playlist) -->
            <div class="playlist-view-section" id="playlistViewSection" style="display: none;">
                <div class="section-header">
                    <span class="section-title" id="playlistViewTitle">playlist</span>
                    <button class="section-link" id="closePlaylistView">back ‚Üê</button>
                </div>
                <div class="art-cards" id="playlistArtCards">
                    <!-- Populated with playlist artworks -->
                </div>
                <div class="playlist-actions">
                    <button class="btn btn-primary" id="playPlaylistBtn">‚ñ∂ play all</button>
                </div>
            </div>
        </div>

        <!-- My Collection Mode -->
        <div class="browse-section" id="myCollectionMode">
            <!-- My Playlists Section -->
            <div class="explore-section" id="myPlaylistsSection">
                <div class="section-header">
                    <span class="section-title">my playlists</span>
                    <button class="section-link" id="createPlaylistBtn">+ new</button>
                </div>
                <div class="my-playlists-grid" id="myPlaylistsGrid">
                    <!-- Populated dynamically with user's playlists -->
                </div>
            </div>

            <!-- Saved Artworks Section -->
            <div class="explore-section">
                <div class="section-header">
                    <span class="section-title">saved artworks</span>
                </div>

                <!-- Collection Controls -->
                <div class="collection-controls">
                    <input type="text" id="collectionSearch" class="collection-search" placeholder="search collection...">
                    <div class="collection-sort">
                        <label class="sort-label">sort by</label>
                        <select id="collectionSort" class="sort-select">
                            <option value="date-desc">newest first</option>
                            <option value="date-asc">oldest first</option>
                            <option value="title-asc">title (a-z)</option>
                            <option value="title-desc">title (z-a)</option>
                            <option value="artist-asc">artist (a-z)</option>
                        </select>
                    </div>
                </div>

                <!-- Rotation Status Bar (only shown when rotation active) -->
                <div class="rotation-status" id="rotationStatus" style="display: none;">
                    <span id="rotationStatusText">rotating 0 images</span>
                    <span class="rotation-controls">
                        <button class="mode-link" id="rotationModeToggle">shuffle</button>
                        <span style="color: #e5e5e5;">¬∑</span>
                        <button class="mode-link" id="rotationIntervalToggle">5 min</button>
                        <span style="color: #e5e5e5;">¬∑</span>
                        <button class="mode-link" id="stopRotationBtn">stop</button>
                    </span>
                </div>

                <!-- Collection Grid -->
                <div class="collection-grid" id="collectionGrid"></div>

                <!-- Show more button -->
                <div class="show-more" id="collectionShowMore" style="display: none;">
                    <button class="show-more-btn" id="showMoreCollectionBtn">show 8 more</button>
                </div>
            </div>
        </div>

    </div>

    <!-- Now Playing Bar (Spotify-like, persistent at bottom) -->
    <div class="now-playing-bar" id="nowPlayingBar" style="display: none;">
        <div class="now-playing-content">
            <div class="now-playing-artwork">
                <img id="nowPlayingThumb" src="" alt="">
            </div>
            <div class="now-playing-info">
                <span class="now-playing-title" id="nowPlayingTitle">Title</span>
                <span class="now-playing-subtitle" id="nowPlayingSubtitle">Artist ¬∑ Playlist</span>
            </div>
            <div class="now-playing-controls">
                <button class="now-playing-btn" id="nowPlayingPrev" title="Previous">‚óÄ</button>
                <button class="now-playing-btn now-playing-btn-main" id="nowPlayingToggle" title="Play/Pause">‚ñ∂</button>
                <button class="now-playing-btn" id="nowPlayingNext" title="Next">‚ñ∂</button>
                <button class="now-playing-btn" id="nowPlayingShuffle" title="Shuffle">‚ü≥</button>
                <button class="now-playing-btn" id="nowPlayingInterval" title="Change interval">5m</button>
                <button class="now-playing-btn" id="nowPlayingExpand" title="Expand">‚åÉ</button>
                <button class="now-playing-btn" id="nowPlayingClose" title="Stop playback">√ó</button>
            </div>
        </div>
    </div>

    <!-- Admin Link -->
    <a href="/admin" class="admin-link">admin</a>

    <!-- Generation Progress Overlay -->
    <div class="generation-overlay" id="generationOverlay">
        <div class="generation-content">
            <div class="generation-spinner"></div>
            <div class="generation-status" id="generationStatusText">Generating image...</div>
            <div class="generation-prompt" id="generationPromptText"></div>
            <div class="generation-filename" id="generationFilenameText"></div>
        </div>
    </div>


    <!-- Art Preview Modal -->
    <div class="modal" id="artModal">
        <div class="modal-content">
            <button class="close-modal" id="closeModalBtn">√ó</button>

            <!-- Unified control bar -->
            <div class="image-control-bar">
                <button class="control-btn-minimal" id="orientationToggle" title="Rotate">‚ü≤</button>
                <span class="control-separator desktop-only">|</span>
                <button class="control-btn-minimal desktop-only" id="moveUp" title="Move up">‚Üë</button>
                <button class="control-btn-minimal desktop-only" id="moveDown" title="Move down">‚Üì</button>
                <button class="control-btn-minimal desktop-only" id="moveLeft" title="Move left">‚Üê</button>
                <button class="control-btn-minimal desktop-only" id="moveRight" title="Move right">‚Üí</button>
                <span class="control-separator desktop-only">|</span>
                <button class="control-btn-minimal desktop-only" id="zoomIn" title="Zoom in">+</button>
                <button class="control-btn-minimal desktop-only" id="zoomOut" title="Zoom out">‚àí</button>
                <button class="control-btn-minimal desktop-only" id="zoomFit" title="Fit to frame">‚ä°</button>
            </div>

            <div class="modal-image-container">
                <img id="modalImage" class="modal-image" src="" alt="">
                <div class="display-frame-overlay"></div>
            </div>
            <div class="modal-info">
                <div class="modal-artwork-details" id="modalArtworkDetails" style="display: none;">
                    <h3 class="modal-title" id="modalTitle"></h3>
                    <p class="modal-artist" id="modalArtist"></p>
                    <p class="modal-year" id="modalYear"></p>
                </div>
                <div class="modal-actions">
                    <button class="modal-btn-primary" id="applyModalBtn">apply to display</button>
                    <button class="modal-btn-secondary" id="modalSecondaryAction" style="display: none;"></button>
                    <button class="modal-btn-secondary" id="moreLikeThisBtn" style="display: none;">‚ú® more like this</button>
                    <button class="modal-btn-tertiary" id="askAboutBtn" style="display: none;">üí¨ ask about this</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Hidden file input -->
    <input type="file" id="fileInput" accept="image/*">

    <!-- Feature modules -->
    <script src="/js/features/search.js"></script>
    <script src="/js/features/discover.js"></script>
    <script src="/js/features/now-playing.js"></script>
    <script src="/js/features/rotation.js"></script>
    <script src="/js/features/art-guide.js"></script>
    <script src="/js/utils/lazy-load.js"></script>
    <!-- Main app initialization -->
    <script src="/js/main.js"></script>
</body>
</html>
